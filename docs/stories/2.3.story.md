# Story 2.3: XÃ¢y dá»±ng Giao diá»‡n Há»— trá»£ Canvas

## Status

Ready for Review

## Story

**As a** user,
**I want** to see a complete application interface with Vietnamese branding and helpful controls,
**so that** I understand the application and can configure it easily.

## Acceptance Criteria

1. Logo "Floro" hiá»ƒn thá»‹ á»Ÿ vá»‹ trÃ­ trung tÃ¢m phÃ­a trÃªn canvas.
2. NÃºt cÃ i Ä‘áº·t (Settings) vá»›i icon gear á»Ÿ gÃ³c pháº£i trÃªn.
3. Modal cÃ i Ä‘áº·t hiá»ƒn thá»‹ khi nháº¥p nÃºt Settings vá»›i ná»™i dung tiáº¿ng Viá»‡t.
4. CÃ i Ä‘áº·t bao gá»“m: hiá»ƒn thá»‹ tá»a Ä‘á»™ chuá»™t, theme, ngÃ´n ngá»¯.
5. Canvas cÃ³ background pattern hoáº·c grid Ä‘á»ƒ táº¡o cáº£m giÃ¡c khÃ´ng gian lÃ m viá»‡c.
6. Táº¥t cáº£ text trong UI sá»­ dá»¥ng tiáº¿ng Viá»‡t.

## Tasks / Subtasks

- [x] Task 1: Implement Application Layout Structure (AC: 1, 2)

  - [x] Create AppLayout component with header and main content areas
  - [x] Create AppHeader component with centered logo and settings button
  - [x] Implement SettingsButton component with gear icon
  - [x] Integrate layout components into main application

- [x] Task 2: Build Settings Modal System (AC: 3, 4)

  - [x] Create SettingsModal component with Vietnamese content
  - [x] Implement settings categories (Display, Canvas, Collaboration)
  - [x] Create DisplaySettings component for coordinate display options
  - [x] Create CanvasSettings component for background and theme options
  - [x] Add settings state management with Zustand store

- [x] Task 3: Implement Canvas Background System (AC: 5)

  - [x] Create CanvasBackground component with multiple pattern types
  - [x] Implement GridBackground pattern renderer
  - [x] Implement DotsBackground pattern renderer
  - [x] Add background configuration options in settings

- [x] Task 4: Create Coordinate Display System (AC: 4)

  - [x] Create CoordinateDisplay component with configurable position
  - [x] Implement mouse position tracking hook
  - [x] Add coordinate format options (decimal/integer)
  - [x] Integrate with canvas viewport system

- [x] Task 5: Vietnamese Localization Implementation (AC: 6)

  - [x] Create localization hook and store
  - [x] Define Vietnamese text constants for all UI elements
  - [x] Implement language switching functionality
  - [x] Ensure all UI text uses Vietnamese by default

- [x] Task 6: Unit Testing
  - [x] Test AppLayout and AppHeader components
  - [x] Test SettingsModal with all categories
  - [x] Test CanvasBackground pattern rendering
  - [x] Test CoordinateDisplay positioning and formatting
  - [x] Test localization system and text switching
  - [x] Test settings state management and persistence

## Dev Notes

### Previous Story Insights

[Source: docs/stories/2.1.story.md#dev-agent-record]

Key learnings tá»« Story 2.1:

- Canvas infrastructure Ä‘Ã£ hoÃ n thÃ nh vá»›i Konva.js integration
- CanvasContainer component Ä‘Ã£ sáºµn sÃ ng Ä‘á»ƒ integrate vá»›i layout system
- Zustand store architecture Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p vÃ  hoáº¡t Ä‘á»™ng tá»‘t
- Component structure Ä‘Ã£ Ä‘Æ°á»£c organize theo unified project structure
- Testing framework Ä‘Ã£ sáºµn sÃ ng vá»›i Jest vÃ  React Testing Library

[Source: docs/stories/2.2.story.md#dev-agent-record]

Key learnings tá»« Story 2.2:

- UI component patterns Ä‘Ã£ Ä‘Æ°á»£c establish vá»›i proper TypeScript interfaces
- Error handling vÃ  loading states patterns Ä‘Ã£ Ä‘Æ°á»£c implement
- Component prop drilling patterns Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p
- Toast notification system Ä‘Ã£ cÃ³ sáºµn Ä‘á»ƒ reuse

### Tech Stack Requirements

[Source: architecture/3-tech-stack.md]

**UI Technology Stack:**

- **Frontend Framework**: Next.js 14+ - Framework React máº¡nh máº½ vá»›i App Router
- **UI Library**: Tailwind CSS - XÃ¢y dá»±ng giao diá»‡n nhanh chÃ³ng vÃ  nháº¥t quÃ¡n
- **UI Components**: Shadcn/ui - Component Ä‘áº¹p, dá»… tÃ¹y chá»‰nh, tÃ¡i sá»­ dá»¥ng
- **State Management**: Zustand - Nháº¹, Ä‘Æ¡n giáº£n, hiá»‡u quáº£ cho nhu cáº§u dá»± Ã¡n
- **Icon System**: Lucide React - Professional icons, SVG-based, tree-shakeable

### Project Structure Requirements

[Source: architecture/6-unified-project-structure.md]

**Layout Components Location:**

```
apps/web/src/components/layout/
â”œâ”€â”€ AppLayout.tsx (NEW)
â”œâ”€â”€ AppHeader.tsx (NEW)
â”œâ”€â”€ SettingsModal.tsx (NEW)
â”œâ”€â”€ SettingsButton.tsx (NEW)
â””â”€â”€ CoordinateDisplay.tsx (NEW)
```

**Canvas Components Enhancement:**

```
apps/web/src/components/canvas/
â”œâ”€â”€ CanvasContainer.tsx (ENHANCE existing)
â”œâ”€â”€ CanvasBackground.tsx (NEW)
â”œâ”€â”€ GridBackground.tsx (NEW)
â””â”€â”€ DotsBackground.tsx (NEW)
```

**Hooks and Stores:**

```
apps/web/src/hooks/ui/
â”œâ”€â”€ useSettings.ts (NEW)
â”œâ”€â”€ useTheme.ts (NEW)
â”œâ”€â”€ useLocalization.ts (NEW)
â””â”€â”€ useMousePosition.ts (ENHANCE existing)

apps/web/src/store/
â”œâ”€â”€ settings.store.ts (NEW)
â””â”€â”€ canvas.store.ts (ENHANCE existing)
```

### UI Components Architecture

[Source: architecture/31-ui-components-architecture.md]

**Component Architecture Patterns:**

```typescript
// UI Shell Component Pattern
interface UIComponentProps {
  className?: string;
  children?: React.ReactNode;
  variant?: "primary" | "secondary";
}

// Theme Configuration
interface ThemeConfig {
  colors: {
    primary: string;
    secondary: string;
    accent: string;
    background: string;
  };
  typography: {
    fontFamily: string;
    fontSize: Record<string, number>;
  };
  spacing: Record<string, number>;
}

// Localization Configuration
interface LocalizationConfig {
  language: "vi" | "en";
  messages: Record<string, string>;
  dateFormat: string;
  numberFormat: Intl.NumberFormatOptions;
}
```

### Application Shell Architecture

[Source: architecture/62-application-shell-architecture.md]

**Layout System Implementation:**

```typescript
// Application Layout Structure
interface AppLayoutProps {
  children: React.ReactNode;
}

const AppLayout: React.FC<AppLayoutProps> = ({ children }) => (
  <div className="h-screen w-screen flex flex-col">
    <AppHeader />
    <main className="flex-1 relative overflow-hidden">{children}</main>
    <CoordinateDisplay />
    <SettingsModal />
  </div>
);

// Header Component Architecture
interface AppHeaderProps {
  className?: string;
}

const AppHeader: React.FC<AppHeaderProps> = ({ className }) => (
  <header className={`bg-white border-b border-gray-200 ${className}`}>
    <div className="flex items-center justify-between px-6 py-3">
      <div className="flex-1" />
      <div className="flex items-center">
        <h1 className="text-2xl font-bold text-gray-900">Floro</h1>
      </div>
      <div className="flex-1 flex justify-end">
        <SettingsButton />
      </div>
    </div>
  </header>
);
```

**Settings System Architecture:**

```typescript
// Settings Modal Component
interface SettingsModalProps {
  isOpen: boolean;
  onClose: () => void;
}

// Settings Categories
interface SettingsCategory {
  id: string;
  title: string;
  icon: React.ComponentType;
  component: React.ComponentType<SettingsCategoryProps>;
}

const settingsCategories: SettingsCategory[] = [
  {
    id: "display",
    title: "Hiá»ƒn thá»‹",
    icon: Monitor,
    component: DisplaySettings,
  },
  {
    id: "canvas",
    title: "Canvas",
    icon: Grid,
    component: CanvasSettings,
  },
  {
    id: "collaboration",
    title: "Cá»™ng tÃ¡c",
    icon: Users,
    component: CollaborationSettings,
  },
];
```

**Canvas Background System:**

```typescript
// Canvas Background Types
type CanvasBackgroundType = "none" | "grid" | "dots" | "lines";

interface CanvasBackgroundProps {
  type: CanvasBackgroundType;
  size: number;
  color: string;
  opacity: number;
  viewport: CanvasViewport;
}

// Background Rendering Strategies
const backgroundRenderers = {
  grid: (props: CanvasBackgroundProps) => <GridBackground {...props} />,
  dots: (props: CanvasBackgroundProps) => <DotsBackground {...props} />,
  lines: (props: CanvasBackgroundProps) => <LinesBackground {...props} />,
  none: () => null,
};
```

**Coordinate Display System:**

```typescript
interface CoordinateDisplayProps {
  position: "top-left" | "top-right" | "bottom-left" | "bottom-right";
  showCanvasCoords: boolean;
  showMouseCoords: boolean;
  format: "decimal" | "integer";
}

const CoordinateDisplay: React.FC<CoordinateDisplayProps> = ({
  position,
  showCanvasCoords,
  showMouseCoords,
  format,
}) => {
  const { viewport } = useCanvasStore();
  const mousePosition = useMousePosition();

  return (
    <div
      className={`fixed ${positionClasses[position]} bg-black/75 text-white px-2 py-1 rounded text-xs font-mono`}
    >
      {showCanvasCoords && (
        <div>
          Canvas: {formatCoordinate(viewport.x, format)},{" "}
          {formatCoordinate(viewport.y, format)}
        </div>
      )}
      {showMouseCoords && (
        <div>
          Mouse: {formatCoordinate(mousePosition.x, format)},{" "}
          {formatCoordinate(mousePosition.y, format)}
        </div>
      )}
    </div>
  );
};
```

### Coding Standards Requirements

[Source: architecture/11-coding-standards.md]

**UI Component Standards:**

- **Components**: PascalCase (AppLayout, SettingsModal, CoordinateDisplay)
- **Hooks**: camelCase vá»›i use prefix (useSettings, useTheme, useLocalization)
- **Type Safety**: Strict TypeScript mode, explicit return types
- **Props Validation**: All component props must have proper TypeScript interfaces
- **Error Boundaries**: UI components pháº£i Ä‘Æ°á»£c wrap trong error boundaries

### Testing Requirements

[Source: architecture/10-testing-strategy.md]

**Testing Standards:**

- **Unit Testing**: Jest for hooks and utility functions
- **Component Testing**: React Testing Library for UI components
- **Integration Testing**: Layout system integration with canvas
- **Test Files**: Co-located vá»›i source files

**UI Component Testing Requirements:**

- **Layout Testing**: AppLayout structure vÃ  responsive behavior
- **Modal Testing**: SettingsModal open/close states vÃ  content rendering
- **Settings Testing**: Settings state management vÃ  persistence
- **Background Testing**: Canvas background pattern rendering
- **Coordinate Testing**: CoordinateDisplay positioning vÃ  formatting
- **Localization Testing**: Vietnamese text rendering vÃ  language switching

**Test File Locations:**

```
apps/web/src/components/layout/__tests__/
â”œâ”€â”€ AppLayout.test.tsx
â”œâ”€â”€ AppHeader.test.tsx
â”œâ”€â”€ SettingsModal.test.tsx
â”œâ”€â”€ SettingsButton.test.tsx
â””â”€â”€ CoordinateDisplay.test.tsx

apps/web/src/hooks/ui/__tests__/
â”œâ”€â”€ useSettings.test.ts
â”œâ”€â”€ useTheme.test.ts
â””â”€â”€ useLocalization.test.ts
```

### Vietnamese Localization Specifications

**Required Vietnamese Text Constants:**

```typescript
const vietnameseTexts = {
  // Header
  appTitle: "Floro",

  // Settings
  settings: "CÃ i Ä‘áº·t",
  display: "Hiá»ƒn thá»‹",
  canvas: "Canvas",
  collaboration: "Cá»™ng tÃ¡c",

  // Display Settings
  showCoordinates: "Hiá»ƒn thá»‹ tá»a Ä‘á»™",
  mouseCoordinates: "Tá»a Ä‘á»™ chuá»™t",
  canvasCoordinates: "Tá»a Ä‘á»™ canvas",
  coordinateFormat: "Äá»‹nh dáº¡ng tá»a Ä‘á»™",
  decimal: "Tháº­p phÃ¢n",
  integer: "Sá»‘ nguyÃªn",

  // Canvas Settings
  backgroundType: "Loáº¡i ná»n",
  backgroundSize: "KÃ­ch thÆ°á»›c ná»n",
  backgroundOpacity: "Äá»™ trong suá»‘t",
  theme: "Giao diá»‡n",
  light: "SÃ¡ng",
  dark: "Tá»‘i",

  // Collaboration Settings
  language: "NgÃ´n ngá»¯",
  vietnamese: "Tiáº¿ng Viá»‡t",
  english: "Tiáº¿ng Anh",

  // Common
  save: "LÆ°u",
  cancel: "Há»§y",
  close: "ÄÃ³ng",
  apply: "Ãp dá»¥ng",
};
```

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4 (Augment Agent - James ğŸ’»)

### Debug Log References

- All tasks completed successfully with comprehensive testing
- Layout system integrated with existing canvas infrastructure
- Settings system implemented with Vietnamese localization
- Background patterns working with viewport awareness
- Coordinate display system functional with configurable options

### Completion Notes

âœ… **Task 1: Application Layout Structure** - Implemented AppLayout, AppHeader, and SettingsButton components with proper integration into main application

âœ… **Task 2: Settings Modal System** - Created comprehensive settings modal with Vietnamese content, tabbed interface, and Zustand state management

âœ… **Task 3: Canvas Background System** - Implemented CanvasBackground with GridBackground and DotsBackground pattern renderers, integrated with settings

âœ… **Task 4: Coordinate Display System** - Created CoordinateDisplay component with configurable positioning, mouse tracking hook, and format options

âœ… **Task 5: Vietnamese Localization** - Implemented useLocalization hook with comprehensive Vietnamese text constants and language switching

âœ… **Task 6: Unit Testing** - Created comprehensive test suites for all components, hooks, and stores with proper mocking

### File List

**New Components:**

- `apps/web/src/components/layout/AppLayout.tsx`
- `apps/web/src/components/layout/AppHeader.tsx`
- `apps/web/src/components/layout/SettingsButton.tsx`
- `apps/web/src/components/layout/SettingsModal.tsx`
- `apps/web/src/components/layout/CoordinateDisplay.tsx`
- `apps/web/src/components/layout/settings/DisplaySettings.tsx`
- `apps/web/src/components/layout/settings/CanvasSettings.tsx`
- `apps/web/src/components/layout/settings/CollaborationSettings.tsx`
- `apps/web/src/components/canvas/CanvasBackground.tsx`
- `apps/web/src/components/canvas/GridBackground.tsx`
- `apps/web/src/components/canvas/DotsBackground.tsx`

**New Hooks:**

- `apps/web/src/hooks/ui/useMousePosition.ts`
- `apps/web/src/hooks/ui/useLocalization.ts`

**New Stores:**

- `apps/web/src/store/settings.store.ts`

**Test Files:**

- `apps/web/src/components/layout/__tests__/AppLayout.test.tsx`
- `apps/web/src/components/layout/__tests__/AppHeader.test.tsx`
- `apps/web/src/components/layout/__tests__/SettingsButton.test.tsx`
- `apps/web/src/components/layout/__tests__/SettingsModal.test.tsx`
- `apps/web/src/components/layout/__tests__/CoordinateDisplay.test.tsx`
- `apps/web/src/components/layout/settings/__tests__/DisplaySettings.test.tsx`
- `apps/web/src/components/canvas/__tests__/CanvasBackground.test.tsx`
- `apps/web/src/hooks/ui/__tests__/useMousePosition.test.ts`
- `apps/web/src/hooks/ui/__tests__/useLocalization.test.ts`
- `apps/web/src/store/__tests__/settings.store.test.ts`

**Modified Files:**

- `apps/web/src/app/page.tsx` - Integrated AppLayout
- `apps/web/src/components/canvas/CanvasContainer.tsx` - Added CanvasBackground

### Change Log

| Date       | Version | Description                                    | Author       |
| ---------- | ------- | ---------------------------------------------- | ------------ |
| 2025-07-20 | 1.0     | Initial story creation for UI interface system | Scrum Master |
| 2025-07-20 | 2.0     | Story implementation completed by Dev Agent    | James (Dev)  |
